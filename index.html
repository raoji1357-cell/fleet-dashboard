<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Driver KPI Search</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display: block; margin-top: 15px; }
    input { padding: 8px; width: 320px; }
    ul { border: 1px solid #ccc; max-width: 320px; list-style: none; padding: 0; margin: 0; }
    li { padding: 6px; cursor: pointer; }
    li:hover { background: #f0f0f0; }
    .kpi { margin-top: 20px; background: #f9f9f9; padding: 15px; border: 1px solid #ddd; }
  </style>
</head>
<body>

<h2>Driver KPI Search</h2>

<label>Select Date</label>
<input type="date" id="dateInput" />

<label>Search Driver / Car Number</label>
<input type="text" id="searchInput" placeholder="Type name or car number" disabled />
<ul id="suggestions"></ul>

<div class="kpi" id="kpiResult"></div>

<script>
/**************** SAMPLE LOCAL JSON (NO SERVER – NO TIMEOUT) ****************/
const data = [
  {
    date: "2026-01-01",
    records: [
      { name: "NEERAJ SAINI", car: "HR55AW6215", trips: 12, earnings: 2450 },
      { name: "RAHUL VERMA", car: "DL8CAF1234", trips: 8, earnings: 1800 }
    ]
  },
  {
    date: "2026-01-02",
    records: [
      { name: "NEERAJ SAINI", car: "HR55AW6215", trips: 6, earnings: 1200 }
    ]
  }
];

/**********************************************************************/
const dateInput = document.getElementById("dateInput");
const searchInput = document.getElementById("searchInput");
const suggestions = document.getElementById("suggestions");
const kpiResult = document.getElementById("kpiResult");

let currentRecords = [];

// DATE CHANGE
dateInput.addEventListener("change", () => {
  searchInput.value = "";
  suggestions.innerHTML = "";
  kpiResult.innerHTML = "";

  const selectedDate = dateInput.value;
  const dayData = data.find(d => d.date === selectedDate);

  if (!dayData) {
    searchInput.disabled = true;
    alert("No data found for this date");
    return;
  }

  currentRecords = dayData.records;
  searchInput.disabled = false;
});

// SEARCH INPUT
searchInput.addEventListener("input", () => {
  const q = searchInput.value.toLowerCase();
  suggestions.innerHTML = "";

  if (!q) return;

  const matches = currentRecords.filter(r =>
    r.name.toLowerCase().includes(q) || r.car.toLowerCase().includes(q)
  );

  matches.forEach(r => {
    const li = document.createElement("li");
    li.textContent = `${r.name} | ${r.car}`;
    li.onclick = () => showKPI(r);
    suggestions.appendChild(li);
  });
});

function showKPI(record) {
  suggestions.innerHTML = "";
  searchInput.value = `${record.name} | ${record.car}`;

  kpiResult.innerHTML = `
    <h3>KPI Result</h3>
    <p><b>Name:</b> ${record.name}</p>
    <p><b>Car:</b> ${record.car}</p>
    <p><b>Trips:</b> ${record.trips}</p>
    <p><b>Earnings:</b> ₹${record.earnings}</p>
  `;
}
</script>

</body>
</html>
